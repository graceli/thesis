\chapter{Molecular Dynamics Simulations}
% This isn't all methods.  The last section is a review of MD simulations of small molecule binding to amyloids.
% But I'm hesitant to call this MD simulations chapter because it isn't all about MD simulations ... or is it?

MD simulations have been used in recent years to gain insight into many fundamental problems in biology and biochemistry, including protein dynamics and function, protein folding,self-aggregation, and protein-ligand binding.
% I like these analogies and I think it will help make my methods sections less dry
In many respects, Molecular Dynamics simulations are very similar to real experiments. When we perform a real experiment, we first prepare a sample of the material that we wish to study. This sample is then connected to a measuring instrument from which we can measure the property of interest during a certain time interval. If our measurements are subject to statistical noise (as most measurements are), then the longer we average, the more accurate our measurement becomes. 

The same approach is applied when performing a Molecular Dynamics simulation. First, a model system consisting of N particles is selected and we record the dynamics of this system (via solving Newton's equation of motion) until the properties of the system no longer change with time (we equilibrate the system). 

After equilibration, we perform the actual measurement. In fact, some of the most common mistakes that can be made when performing a computer experiment are very similar to the mistakes that can be made in real experiments (e.g., the sample is not prepared correctly, the measurement is too short, the system undergoes an irreversible change during the experiment, or we do not measure what we think).
(Copied and adapted from Molecular Simulations book)

MD simulations employ an empirical mathematical function to describe the atomic interactions in a molecular system, and together with classical laws of Newtonian mechanics, to simulate systems undergoing thermal motion from which atomic trajectories are generated. 

Thermodynamic and kinetic properties can then be extracted as time averages from these trajectories and used to make a number of predictions that are often experimentally challenging to observe or measure.

\section{Approximations in MD}
% Approximations made in MD.
% Note the audience of your thesis.  It is good to cover basic ground.  I think I should also brief talk about enhanced techniques.

MD is a molecular mechanics simulation technique.  Molecular mechanics is the model of interactions in the system. There are many assumptions made in MD.  In MD, classical mechanics is used to describe the motion of atoms.  In a biomolecular system, covalent bond stretching and angle-bending motions are treated as harmonic.

The potential energy function (or force field) is a function of the positions of atoms only.  Under the Born-Oppenheimer approximation, electronic and nuclear motions are uncoupled, and can therefore be treated separately.  
% M. Born and R. Oppenheimer, “Quantum Theory of Molecules,” Ann. Physics, vol. 84, pp. 457–484, 1927.
In MD, the movements of all atomic nuclei are treated as classical particles (that is, an atom is a point charge in space), where the movement of electrons are not accounted for. Instead, the effects of electronic motion is implicitly accounted for in the force field (described in more detail below). Because electronically excited states are not treated, no chemical reactions occur in the system. 
This classical mechanics provide a valid approximation of many biological systems % XXX 

Force fields do not account for polarizability of molecules.  because of its prohibitive computational cost.
Polarizability is a property of matter, and is the measure of the change in a molecule's electron distribution in response to an applied electric field, which can also be induced by electric interactions with solvents or ionic reagents. 

To treat a bulk system and avoid phase boundaries, periodic boundary conditions are used.  Although this is unnatural, for sufficiently large systems, the errors induced by periodic boundaries are negligible. REFS

\section{Core Algorithm}
For a system of N interacting atoms, the force for each atom pair in the system is determined by the spatial derivative of the potential energy of the atom pair in the system,
% Not exactly ... according to Chris Madill's thesis, U is the potential energy between an atom pair
\begin{equation}
% F_i = - \nabla U
  F_i = - \frac{\delta V}{\delta r_i}, i = 1,2,3,..., N
\end{equation}

where $V$ is the potential energy of the system. The calculated force vectors are summed together, yielding the net force vector acting on every atom in the system. 

In MD simulations, $V$ is approximated using a molecular mechanics force field, a set of parameters which describes the interaction energies of the atoms in the system.

The acceleration $a_i$ of each atom is given by,
\begin{equation}
a_i = \frac{F_i}{m_i}
\end{equation}
where $m_i$ is the mass of the atom $i$.

The next position of the atom at time $ t + \delta t$
\begin{equation}
x_i(t + \delta t) = x_i(t) + v_i(t)\delta t + \frac{a_i(t)\delta t^2}{2}	
\end{equation}

The above equations are solved numerically using a time integration algorithm using a small timestep. For numerical stability reasons, a small integration step in the range of 1 - 4 femtoseconds is employed. Typically, a timestep of 2 fs is used, which is twice the time period for the fastest vibrational motion (for bonds involving hydrogen), is used in MD simulations of biomolecular systems. % [Ref: Chris Madill's and Tom's thesis]

There are many different forms of integration algorithms, with the most common being the Verlet and leap-frog algorithms. 
% According to gromacs manual:
% md - is a leap-frog algorithm for integrating Newton's equation.
% Note that in absence of pressure and temperature coupling, verlet and leap-frog is equivalent ... and generates identical trajectories of motion.

% How much detail? Talk about the velocity verlet integration algorithm ?
A simulation proceeds iteratively: once all of the new positions for all atoms are predicted, interatomic forces are updated based on these new coordinates, and this entire process is repeated.

% Marty's thesis included a little bit on the verlet algorithm.  CN did not.
\section{Temperature}
I copied this from ``Molecular simulations the book''

For instance, a convenient definition of the temperature in a (classical) many-body system makes use of the equipartition of energy over all degrees of freedom that enter quadratically in the Hamiltonian of the system. In particular for the average kinetic energy per degree of freedom, we have
\begin{equation}
  \langle \frac{1}{2} mv_{\alpha}^2 \rangle =   \frac{1}{2} k_BT
\end{equation}

In a simulation, we use this equation as an operational definition of the tem- perature. In practice, we would measure the total kinetic energy of the sys- tem and divide this by the number of degrees of freedom Nr (= 3N - 3 for a system of N particles with fixed total momentum1). As the total kinetic energy of a system fluctuates, so does the instantaneous temperature:

\begin{equation}
  T(t) = \sum_{i=1}^{N} \frac{m_iv_i^2(t)}{k_BN_f}
\end{equation}

\section{Temperature and pressure-coupling}
Copied from the GROMACS manual

While direct use of molecular dynamics gives rise to the NVE (constant number, constant volume, constant energy ensemble), most quantities that we wish to calculate are actually from a constant temperature (NVT) ensemble. 

To simulate a system under an ensemble which matches most experimental settings, where temperature and pressure is often held constant, we can modify the above introduced equations by adding additional terms which introduces a thermal heat bath (Nose-Hoover temperature coupling scheme) to which we couple our simulation to.
%\cite{[25] Nose ́, S. A molecular dynamics method for simulations in the canonical ensemble. Mol. Phys. 52:255–268, 1984.[26] Hoover, W. G. Canonical dynamics: equilibrium phase-space distributions. Phys. Rev. A 31:1695–1697, 1985.}

Using the same idea, we can couple the system to a pressure bath.  This method is called the Parrinello-Rahman pressure coupling, and the theory has been shown to correctly produce the NpT ensemble.
% \cite{Parrinello, M., Rahman, A. Polymorphic transitions in single crystals: A new molecular dynamics method. J. Appl. Phys. 52:7182–7190, 1981. [35] Nose ́, S., Klein, M. L. Constant pressure molecular dynamics for molecular systems. Mol. Phys. 50:1055–1076, 1983.}
% Should I include the equations? I haven't seen this in other thesis, perhaps its too much detail.

\section{Force field}
The outcome of the simulations are controlled by an expression for the total potential energy of the system collectively referred to as the force field.

Application of an empirical force field is used in MD to approximate atomic interactions in the system. A force field typically has many parameters which need to be calculated. One approach to do this is to fit to quantum mechanical calculations.  Often, force fields are iteratively improved by predicting experimentally observable quantities for small compounds, and adjusting the fit based on comparisons of these computationally predicted quantities with experimental measurements.
  
Many different force fields have been developed for the purpose of simulating biomolecular systems. Existing force fields such as AMBER, GROMOS, CHARMM, OPLS-AA, all differ slightly in the functional form and parameterization of the potential energy function. We have chosen to use the OPLS-AA/L (results in chapters 3 to 5) and AMBER99 force fields (chapter 6) in this thesis. OPLS models atomic connectivity based on AMBER, but was developed to reproduce liquid state properties (water, and 40 other organic liquids) such as XXX and YYY.\cite{jay ponder, the opls 1986 paper, and the 1996 all atom paper} 
% Note that if I say this .. I might have to justifiy this in my defense.

The general form of the force field potential energy function used in OPLS-AA is
  % \[ V(R) = bonds + angles + impropers + dihedrals + pair interactions \]
  \begin{equation}
    \begin{split}
          E = \sum_{bonds} k_b(b-b_0)^2 
          + \sum_{angles} k_{\theta}(\theta - \theta_{0})^2 \\
          + \sum_{dihedrals} k_{\chi}(1 + cos(n\chi - \delta)) 
          + \sum_{impropers} k_{\gamma}(\phi - \phi_{0})^2 \\
          + \sum_{nonbonded} \frac{q_1q_2}{er} \\
          + \sum_{nonbonded} \epsilon [(\frac{r_{min}}{r})^{12} - 2(\frac{r_{min}}{r})^6]
    \end{split}
  \end{equation}

% Initial conditions -- initial positions of the atoms in the system
Simulation systems are usually in the canonical ensemble (NVT), and isothermo-isobaric (NPT) ensembles.

Inclusion of temperature in MD allows for the account of entropy in our systems.  This is especially important for the determination of free energies, G. 


% Note that because I talk a lot about binding ... this discussion within my methods section may be quite important for examing members that understands the physics but do not understand how MD simulations in particular is rigoroous enough to make any of those predictions.  Having those details here means that I understand how that link is established and that I'm not just making up stories based on pretty pictures.

% \subsection{Setting up a MD simulation: practical aspects}
% Here are some details to run a MD simulation of a biomolecular system.  I think I could omit this from my introduction as this is not really essential in understanding the rest of my thesis, or is it? Perhaps this should go into an appendix instead.

% The following steps are often used to setup and start a MD simulation system of a protein. First, a pre-determined structure, typically a coordinate structure from X-ray crystallography or NMR, or homology-modelling data. Then a force field and solvent is chosen.

\section{Challenges and limitations of MD}

Given the approximations of MD, MD is well-suited for probing the dynamics of complex systems on the timescale of picoseconds to seconds.

MD is computationally limited in both length and time scales. Many of the biologically interesting events, such as protein folding, ligand binding, and conformational isomerization occur on timescales of milliseconds and seconds.  Even with the amount of computing power available today, however, MD simulations is limited to studying systems on the timescale of microseconds, with few studies reaching timescales of milliseconds. Furthermore, many complex biological systems are still large enough to obtain quantitative predictions. Although boundaries in these respects are being pushed constantly\cite{DE Shaw, Chris Neale, Sarah}

Obtaining convergence. Explain why this is difficult, in particular for systems with disordered peptides.			
% Evaluating the convergence of simulations is still a challenge
% Limitations in the accuracy of current force fields.
% Time scale. Relevant biochemical reactions such as protein folding happens on the time scale of milliseconds, hours, and days. Currently with MD simulations, we are routinely able to approach the microsecond time scale, massive computing power is still insufficient to observe phenomena on the millisecond timescale. % Ref: DE Shaw Research.

\section{Application of MD in structure-based drug discovery}

% \1 (Why computational?) Can help us get protein dynamics is important for understanding protein function. We want to understand protein function because we want to be able to design drugs to cure diseases.

% \1 A important application of MD simulation in biochemistry is the predicting of protein-ligand binding free energies.

One application of MD simulations is in rational drug design. In recent years structure-based computer modeling of protein-ligand interactions have become a core component of modern drug discovery.  In early stage drug discovery, a target is identified along with putative binding sites.  Then, the structure of the target is determined using structural determination techniques such as NMR or X-ray crystallography.
% [See Tom's thesis]
Ligands which may act as potential drugs are expected to bind with a high affinity (low $K_d$) to the binding site. The goal is to discover,  high specificity inhibitors of a protein (usually an enzyme). In this process, the binding free energy of the ligand to its target is used to quantitatively evaluate how well a ligand binds. A crude estimate of the binding affinity can be obtained using computational docking methods, where the energetics of binding is typically estimated without accounting for either ligand or protein flexibility.  Although docking is fast, it is often inaccurate for identifying true drug candidates.

With computer hardware becoming faster and cheaper, MD simulations can be used to rapidly prototype experimental ideas -- for example, one can perform computational alchemy, that is, ``mutate'' residues to test various hypotheses. Furthermore, simulations may be used to determine whether a chemical change will produce a more potent drug candidate. Currently, state of the art computational binding studies use MD simulations, where the protein and drug is allowed to relax and freely move about in the system. However, in the case of understanding a specific binding reaction often needed when developing an enzyme inhibitor, the ability to observe the relevant binding events is a low probability event on the timescale achievable by simulations. Therefore, a few enhanced techniques have been developed to accelerate this process.  They are briefly introduced below.

\section{Free energy calculations}
There are two advanced methods that have been developed for determining the absolute binding free energies in combination with MD simulations.

% \3 Linear interaction energy -- Out of scope
% \3 MM/PBSA - no explicit account for solvents -- Out of scope
\subsection{Thermodynamic perturbation}
This is the paper that I am taking most of the topics here\cite{Gilson:2007hz}

\subsection{Thermodynamic integration}
I actually have no idea what this is, and would be hard pressed to explain this properly.
In this case, I don't think I should be covering these topics in my thesis.

\subsection{Free energy perturbation}
Alchemically change one molecule into another

\section{Review of MD studies of amyloid inhibition by small molecules}
% MD studies using brute-force sampling. Aid in medicinal chemistry by making suggestions for how to design new AD drugs.

\begin{outline}
	%  Excerpt from Transfer proposal
	\1 In recent years, molecular dynamics simulations have been intensively used to investigate the molecular basis of the structure and stability of amyloid fibrils. 
	
	\1 MD simulations of Congo red binding have been done with the protofibril-like crystal structure composed of the segment GNNQQNY.\{Wu, 2007 \#621\}
	
	\1 A recent simulation study of an N-methylated peptide with A$\beta$16-22 models of amyloid aggregates has provided insight into the possible mechanism of action of peptide inhibitors of amyloid formation.\{Soto, 2007 \#597\} This peptide inhibitor was shown to preferentially bind monomers to form dimers, possibly acting to inhibit fibril formation by sequestering monomers. However, peptide-based inhibitors have poor pharmacological profiles as they are actively broken down by proteases in the stomach and are difficult to transport across the blood-brain barrier. In addition, these peptide inhibitors specifically target A$\beta$ and thus do not have the potential to treat multiple amyloid diseases.
\end{outline}

\addcontentsline{toc}{section}{Bibliography}
\bibliographystyle{plain}
\bibliography{chapter1}

% Scrap
% Motivate the use of MD simulations
% Describe the details of molecular dynamics simulations
% Review the basic derivations of MD simulation equations and why they work

% Molecular dynamics simulations are a useful tool to study the structure, dynamics, and interaction of biomolecules. 

% MD is a numerical algorithm which solves a system of Newtonian equations of motion, and provides as output the time-trajectory of atoms with femtosecond time resolution.

% To review before my defense

% Details of the mathematics (need to review the basic theory + Taylor series expansion) - get a book - tomorrow maybe?

% Why is MD correct? Describe the fundamental assumptions of MD. Here, I want to give the readers who aren't familiar with the methodological details of MD a sense of the rigorousness of MD.

% The assumption at a hand-wave level adapted from Tom's thesis

% - Relationship between force and energy 
% - Relationship between momentum and velocity 
% - Why numerical approach must be used (no analytical solution for N > 2)
% - How is the force field plugged into the general algorithm.